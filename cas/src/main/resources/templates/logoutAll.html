<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>注销</title>
</head>

<body>
    <h2>成功注销！</h2>
    <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.5.1.min.js"></script>
    <script type="text/javascript">
        function logoutAll() {
            var urls = ["http://localhost:8081/app1/logout",
                "http://localhost:8082/app2/logout",
                "http://localhost:8080/cas/logout"]; // 最后再删除cas本地的jwt，因为删除子系统的jwt是必须要有cas的jwt否则app_jwt会被视作无效
            // for (let i = 0; i < urls.length; i++) { // 这里不用let可能会由于js函数提升导致后面console出错
            //     $.ajax({
            //         type: 'GET',
            //         url: urls[i],
            //         async: false,
            //         crossDomain: true,
            //         dataType: 'jsonp',
            //         success: function (data) {
            //             console.log("成功注销" + urls[i] + "的令牌");
            //         },
            //         fail: function (data) {
            //             // console.log("失败");
            //         },
            //         error: function (result) {
            //             console.log("失败");
            //         }
            //     })
            // }
            // 这里因为拦截所以app1和app2的请求都会失败导致cas先请求，所以cas的jwt会先被删除之后app的jwt就无效了就会又登录
            $.ajax({
                type: 'GET',
                url: "http://localhost:8081/app1/logout",
                async: false,
                crossDomain: true,
                dataType: 'jsonp',
                success: function (data) {
                    console.log("成功注销" + urls[i] + "的令牌");
                },
                error: function (result) {
                    console.log("失败");
                    $.ajax({
                        type: 'GET',
                        url: "http://localhost:8082/app2/logout",
                        async: false,
                        crossDomain: true,
                        dataType: 'jsonp',
                        success: function (data) {
                            console.log("成功注销" + urls[i] + "的令牌");
                        },
                        error: function (result) {
                            $.ajax({
                                type: 'GET',
                                url: "http://localhost:8080/cas/logout",
                                async: false,
                                crossDomain: true,
                                dataType: 'jsonp',
                                success: function (data) {
                                    console.log("成功注销cas的令牌");
                                },
                                error: function (result) {
                                    console.log("失败");
                                }
                            })
                        }
                    })
                }
            })
        }
        logoutAll();
    </script>
</body>

</html>